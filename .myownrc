# ----------------------------------------------------------------------------
# BASIC ENVIRONMENTAL VARIABLES  ---------------------------------------------

export EDITOR=micro
export VISUAL=micro

# ----------------------------------------------------------------------------
# ALIASES  -------------------------------------------------------------------

# show numerical permissions of content of the current directory
alias statt='stat -c "%A %a %n" *'
# ip command with colors
alias ip='ip --color=auto'

# wireguard - show active tunnels
# to not need sudo: sudo setcap cap_net_admin+ep $(which wg)
alias wgs='wg show'
# wireguard - brings down current active wireguard interface
# to not need sudo edit sudoers
alias wgd='wg show interfaces | xargs -n1 sudo wg-quick down'
# make locate case insensitive by default
alias locate='locate -i'

# lsblk to include labels by default but allow normal use
lsblk() {
    if [[ $# -eq 0 ]]; then
        command lsblk -o LABEL,NAME,SIZE,TYPE,MOUNTPOINT
    else
        command lsblk "$@"
    fi
}

# ----------------------------------------------------------------------------
# FD  -----------------------------------------------------------------------

# fd is simpler and faster find command, but to really show everything
alias fd='fd --hidden --no-ignore --ignore-case'

# ----------------------------------------------------------------------------
# FZF  -----------------------------------------------------------------------

# fzf just filters whatever default command gives it
# fd is simpler and faster find command so it is used
# can be used in nnn with ";" and "f", or anywhere with "fzf"
export FZF_DEFAULT_COMMAND='fd --hidden --no-ignore --ignore-case'
export FZF_DEFAULT_OPTS="--exact"

# ----------------------------------------------------------------------------
# NNN FILE MANAGER  ----------------------------------------------------------

# nnn alias that shows hidden files, ownership and filter without entering
# nnn starts in docker directory if it exists, name can be in whatever case

starting_dir=$(find $HOME -maxdepth 1 -type d -iname "docker" | head -n 1)
if [ -n "$starting_dir" ] && [ -d "$starting_dir" ]; then
    alias n="cd $starting_dir && nnn -H -U -A"
else
    alias n="nnn -H -U -A"
fi

# sudo version
alias nnnn='sudo -E nnn -H -U -A'

# enable trash; different colors for tabs; bookmarks
export NNN_TRASH=1
export NNN_COLORS='2136'
export NNN_BMS='h:~;d:~/docker;e:/etc;s:/etc/systemd/system;m:/mnt;v:/var;o:/opt;l:/var/log;t:/tmp'
export NNN_PLUG='f:fzcd;'   # to use fzf in nnn press ";f"

# shell opened from nnn using ! hotkey has indication of depth
[ -n "$NNNLVL" ] && PS1="N$NNNLVL $PS1"

# ----------------------------------------------------------------------------
# YAZI FILE MANAGER  ----------------------------------------------------------

# for yazi to exit in the current directory
function yazi() {
  local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
  command yazi "$@" --cwd-file="$tmp"
  IFS= read -r -d '' cwd < "$tmp"
  [ -n "$cwd" ] && [ "$cwd" != "$PWD" ] && builtin cd -- "$cwd"
  rm -f -- "$tmp"
}

# yazi starts in docker directory if it exists
starting_dir="$HOME" # could be empty if starting where launched
found_docker=$(find "$HOME" -maxdepth 1 -type d -iname docker -print -quit)
[[ -n $found_docker ]] && starting_dir="$found_docker"
alias yy="yazi $starting_dir"
alias zz=yy

# indicate shell was spawned by yazi
if [ -n "$YAZI_ID" ]; then
    PS1="[Î¨] $PS1"
fi

# as root but with $USER variables
alias yyy='sudo -E yazi'
alias zzz='sudo -E yazi'

# ----------------------------------------------------------------------------
# ZSH CUSTOM HOTKEYS ---------------------------------------------------------

# ctr+f prepends sudo on current line
add_sudo (){
    BUFFER="sudo $BUFFER"
    zle -w end-of-line
}
zle -N add_sudo
bindkey "^f" add_sudo

# ----------------------------------------------------------------------------
# DUF ------------------------------------------------------------------------

# fixing colors
export COLORTERM=truecolor

# hide temporary filesystem for cleaner output
alias duf='duf -hide-fs tmpfs'

# ----------------------------------------------------------------------------
# YT-DLP ---------------------------------------------------------------------

alias you='yt-dlp --embed-chapters --embed-subs --sub-lang en --write-auto-sub --sub-format srt --merge-output-format mkv -f "bestvideo[height=1440]+bestaudio/bestvideo[height<=1080]+bestaudio/best"'
alias you2='yt-dlp --embed-chapters --embed-subs --sub-lang en --write-auto-sub --sub-format srt --merge-output-format mkv -f "bestvideo[height=1080]+bestaudio/best[height=1080]/bestvideo[height<=1080]+bestaudio/best[height<=1080]"'
alias you3='yt-dlp --embed-chapters --embed-subs --sub-lang en --write-auto-sub --sub-format srt --merge-output-format mkv'
alias youp='yt-dlp --embed-chapters --embed-subs --sub-lang en --write-auto-sub --sub-format srt --merge-output-format mkv -o "%(playlist_index)s_ %(title)s.%(ext)s"'

# ----------------------------------------------------------------------------
# ----------------------------------------------------------------------------
